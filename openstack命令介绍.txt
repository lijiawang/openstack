创建用户
# openstack user create --password qwe qwe     #创建用户
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 0767892795bf410c9aa0d046905c96f4 |
| name                | qwe                              |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+

创建项目
# openstack project create qwe --domain default   #创建项目
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description |                                  |
| domain_id   | default                          |
| enabled     | True                             |
| id          | 3d6119905daf42a39b29615a910cecf6 |
| is_domain   | False                            |
| name        | qwe                              |
| parent_id   | default                          |
+-------------+----------------------------------+
# openstack role list
+----------------------------------+------------------+
| ID                               | Name             |
+----------------------------------+------------------+
| 423d8d730c65452382a72e29fbab93af | admin            |
| 9fe2ff9ee4384b1894a90878d3e92bab | _member_         |
| b6e129ccf4d04f71a9c930156822d557 | heat_stack_owner |
| bba3306478e44cfea40ca8802c19316c | heat_stack_user  |
+----------------------------------+------------------+
给用户分配一个用户和角色
# openstack role add --project qwe --user qwe _member_          #给用户分配一个用户和角色

# openstack role create asd                 # 创建角色
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | d6f44544073049e58bb66aa620e5ba2a |
| name      | asd                              |
+-----------+----------------------------------+

# openstack image list
+--------------------------------------+---------+--------+
| ID                                   | Name    | Status |
+--------------------------------------+---------+--------+
| 55e5283a-f590-457b-94bf-724bcc8258b0 | cirros  | active |
| 23fadb9a-24e8-4c8c-aae4-3582705e8b01 | cirros1 | active |
+--------------------------------------+---------+--------+
# openstack  flavor list
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
| ID                                   | Name       |   RAM | Disk | Ephemeral | VCPUs | Is Public |
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
| 1                                    | tiny       |   256 |    1 |         0 |     1 | True      |
| 620d808f-d2e9-4f59-89b2-44c8ad7bcbbe | standard-4 |  8192 |   40 |         0 |     4 | True      |
| 9efd2f60-93ce-4777-aa4c-781a16846e10 | standard-2 |  4096 |   40 |         0 |     2 | True      |
| a3b2426e-7d42-4684-b111-89b08561a840 | standard-8 | 16384 |   40 |         0 |     8 | True      |
| b67de1cf-c22d-4445-90d6-f0f21a4d8c5e | micro-1    |   512 |   40 |         0 |     1 | True      |
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
# openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| a98e9878-cf6a-4630-9f59-ec684a052842 | 192.168.18.14       | 10.0.0.19        | 82076c71-3fc0-4522-8fca-4d99b4eae102 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
# openstack network list
+--------------------------------------+----------+--------------------------------------+
| ID                                   | Name     | Subnets                              |
+--------------------------------------+----------+--------------------------------------+
| 0896efb0-a93f-4d3a-a3cd-5f662a50d097 | ljw-net  | 46067d59-c75a-4542-b817-74052436776a |
| 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | public1  | aaaa1253-4313-47fe-9280-af4065dd556b |
| f99fbfd5-b835-49a2-b3fe-0b88815c81ec | demo-net | 19629916-bb6e-49bd-ad56-6065be808376 |
+--------------------------------------+----------+--------------------------------------+
# openstack image list
+--------------------------------------+---------+--------+
| ID                                   | Name    | Status |
+--------------------------------------+---------+--------+
| 55e5283a-f590-457b-94bf-724bcc8258b0 | cirros  | active |
| 23fadb9a-24e8-4c8c-aae4-3582705e8b01 | cirros1 | active |
+--------------------------------------+---------+--------+
# openstack server create --image cirros --flavor timy --nic net-id=0896efb0-a93f-4d3a-a3cd-5f662a50d097 test-vm
No flavor with a name or ID of 'timy' exists.
# openstack server create --image cirros --flavor 1 --nic net-id=0896efb0-a93f-4d3a-a3cd-5f662a50d097 test-vm
+-------------------------------------+-----------------------------------------------+
| Field                               | Value                                         |
+-------------------------------------+-----------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                        |
| OS-EXT-AZ:availability_zone         |                                               |
| OS-EXT-SRV-ATTR:host                | None                                          |
| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                          |
| OS-EXT-SRV-ATTR:instance_name       |                                               |
| OS-EXT-STS:power_state              | NOSTATE                                       |
| OS-EXT-STS:task_state               | scheduling                                    |
| OS-EXT-STS:vm_state                 | building                                      |
| OS-SRV-USG:launched_at              | None                                          |
| OS-SRV-USG:terminated_at            | None                                          |
| accessIPv4                          |                                               |
| accessIPv6                          |                                               |
| addresses                           |                                               |
| adminPass                           | K9FBfxaM3PjB                                  |
| config_drive                        |                                               |
| created                             | 2017-06-30T12:58:23Z                          |
| flavor                              | tiny (1)                                      |
| hostId                              |                                               |
| id                                  | aba04242-7a5c-4c70-8186-cfc99042c0b1          |
| image                               | cirros (55e5283a-f590-457b-94bf-724bcc8258b0) |
| key_name                            | None                                          |
| name                                | test-vm                                       |
| progress                            | 0                                             |
| project_id                          | ae94d1072be14ea28892af5bc660d4c4              |
| properties                          |                                               |
| security_groups                     | name='default'                                |
| status                              | BUILD                                         |
| updated                             | 2017-06-30T12:58:23Z                          |
| user_id                             | 796c55f5fbbb4db0a41b3ea8ed256a5d              |
| volumes_attached                    |                                               |
+-------------------------------------+-----------------------------------------------+

创建秘钥
# openstack keypair create lijiawang > lijiawang.pem
# chmod 600 lijiawang.pem 
# openstack keypair list
+-------------+-------------------------------------------------+
| Name        | Fingerprint                                     |
+-------------+-------------------------------------------------+
| ansible_key | 9b:f9:68:d2:4d:64:e5:36:d9:09:97:4a:cf:6b:65:0b |
| lijiawang   | 1c:3b:fe:27:b8:b5:cf:8c:ce:42:5f:1b:2e:42:aa:42 |
+-------------+-------------------------------------------------+
创建flavor
# openstack flavor create --ram 512 --disk 1 --vcpus 1 m1.tiny
# openstack flavor list
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
| ID                                   | Name       |   RAM | Disk | Ephemeral | VCPUs | Is Public |
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
| 1                                    | tiny       |   256 |    1 |         0 |     1 | True      |
| 620d808f-d2e9-4f59-89b2-44c8ad7bcbbe | standard-4 |  8192 |   40 |         0 |     4 | True      |
| 9bfbf852-93a6-4108-b60c-81b6616e9587 | m1.tiny    |   512 |    1 |         0 |     1 | True      |
| 9efd2f60-93ce-4777-aa4c-781a16846e10 | standard-2 |  4096 |   40 |         0 |     2 | True      |
| a3b2426e-7d42-4684-b111-89b08561a840 | standard-8 | 16384 |   40 |         0 |     8 | True      |
| b67de1cf-c22d-4445-90d6-f0f21a4d8c5e | micro-1    |   512 |   40 |         0 |     1 | True      |
+--------------------------------------+------------+-------+------+-----------+-------+-----------+
列出可用的安全组

创建实例
# openstack server create --image 5d906843-3869-48ac-a72f-af8fef52844f \
--nic net-id=0896efb0-a93f-4d3a-a3cd-5f662a50d097 \
--flavor m1.tiny \
--key-name lijiawang test-vm
+-------------------------------------+------------------------------------------------+
| Field                               | Value                                          |
+-------------------------------------+------------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                         |
| OS-EXT-AZ:availability_zone         |                                                |
| OS-EXT-SRV-ATTR:host                | None                                           |
| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                           |
| OS-EXT-SRV-ATTR:instance_name       |                                                |
| OS-EXT-STS:power_state              | NOSTATE                                        |
| OS-EXT-STS:task_state               | scheduling                                     |
| OS-EXT-STS:vm_state                 | building                                       |
| OS-SRV-USG:launched_at              | None                                           |
| OS-SRV-USG:terminated_at            | None                                           |
| accessIPv4                          |                                                |
| accessIPv6                          |                                                |
| addresses                           |                                                |
| adminPass                           | 73DrWxAde6U7                                   |
| config_drive                        |                                                |
| created                             | 2017-06-30T14:16:32Z                           |
| flavor                              | m1.tiny (9bfbf852-93a6-4108-b60c-81b6616e9587) |
| hostId                              |                                                |
| id                                  | 132e5c32-b18c-40e7-bab0-af313ce35b41           |
| image                               | cirros (5d906843-3869-48ac-a72f-af8fef52844f)  |
| key_name                            | lijiawang                                      |
| name                                | test-vm                                        |
| progress                            | 0                                              |
| project_id                          | ae94d1072be14ea28892af5bc660d4c4               |
| properties                          |                                                |
| security_groups                     | name='default'                                 |
| status                              | BUILD                                          |
| updated                             | 2017-06-30T14:16:33Z                           |
| user_id                             | 796c55f5fbbb4db0a41b3ea8ed256a5d               |
| volumes_attached                    |                                                |
+-------------------------------------+------------------------------------------------+

创建浮动ip
# openstack floating ip create public1
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| created_at          | 2017-06-30T14:45:41Z                 |
| description         |                                      |
| fixed_ip_address    | None                                 |
| floating_ip_address | 192.168.18.13                        |
| floating_network_id | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc |
| id                  | f30ebb2d-1fca-4dfb-8747-6e264215754e |
| name                | 192.168.18.13                        |
| port_id             | None                                 |
| project_id          | ae94d1072be14ea28892af5bc660d4c4     |
| revision_number     | 1                                    |
| router_id           | None                                 |
| status              | DOWN                                 |
| updated_at          | 2017-06-30T14:45:41Z                 |
+---------------------+--------------------------------------+
列出分配给项目的所有浮动ip
# openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| a3cbe1c7-3399-4c0d-9e65-09a9a494ca49 | 192.168.18.11       | 10.0.0.17        | 0119814b-7e07-4eb0-91bf-b085a9a20ea7 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
| a98e9878-cf6a-4630-9f59-ec684a052842 | 192.168.18.14       | None             | None                                 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
将浮动ip地址与项目中的实例关联
# openstack server add floating ip test-vm 192.168.18.14
# openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| a3cbe1c7-3399-4c0d-9e65-09a9a494ca49 | 192.168.18.11       | 10.0.0.17        | 0119814b-7e07-4eb0-91bf-b085a9a20ea7 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
| a98e9878-cf6a-4630-9f59-ec684a052842 | 192.168.18.14       | 10.0.0.16        | 213daf52-fd4f-4692-8cd1-92b70409bc85 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+

取消关联浮动ip地址
# openstack server remove floating ip 132e5c32-b18c-40e7-bab0-af313ce35b41 192.168.18.14
# openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| a3cbe1c7-3399-4c0d-9e65-09a9a494ca49 | 192.168.18.11       | 10.0.0.17        | 0119814b-7e07-4eb0-91bf-b085a9a20ea7 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
| a98e9878-cf6a-4630-9f59-ec684a052842 | 192.168.18.14       | None             | None                                 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
从项目中删除浮动ip地址
# openstack floating ip delete 192.168.18.14
# openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| a3cbe1c7-3399-4c0d-9e65-09a9a494ca49 | 192.168.18.11       | 10.0.0.17        | 0119814b-7e07-4eb0-91bf-b085a9a20ea7 | 314ac1b1-ac84-432e-9f0f-9b545cf0d6fc | ae94d1072be14ea28892af5bc660d4c4 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+

暂停和取消暂停一个实例
暂停实例
# openstack server pause vm
# openstack server list
+--------------------------------------+---------+--------+----------------------------------+------------+
| ID                                   | Name    | Status | Networks                         | Image Name |
+--------------------------------------+---------+--------+----------------------------------+------------+
| 132e5c32-b18c-40e7-bab0-af313ce35b41 | test-vm | ACTIVE | ljw-net=10.0.0.16, 192.168.18.13 | cirros     |
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm      | PAUSED | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+---------+--------+----------------------------------+------------+
取消暂停服务
# openstack server unpause vm
# openstack server list
+--------------------------------------+---------+--------+----------------------------------+------------+
| ID                                   | Name    | Status | Networks                         | Image Name |
+--------------------------------------+---------+--------+----------------------------------+------------+
| 132e5c32-b18c-40e7-bab0-af313ce35b41 | test-vm | ACTIVE | ljw-net=10.0.0.16, 192.168.18.13 | cirros     |
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm      | ACTIVE | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+---------+--------+----------------------------------+------------+
挂起并恢复一个实例
挂起
# openstack server suspend vm
# openstack server list
+--------------------------------------+---------+-----------+----------------------------------+------------+
| ID                                   | Name    | Status    | Networks                         | Image Name |
+--------------------------------------+---------+-----------+----------------------------------+------------+
| 132e5c32-b18c-40e7-bab0-af313ce35b41 | test-vm | ACTIVE    | ljw-net=10.0.0.16, 192.168.18.13 | cirros     |
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm      | SUSPENDED | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+---------+-----------+----------------------------------+------------+
恢复
# openstack server resume vm
# openstack server list
+--------------------------------------+---------+--------+----------------------------------+------------+
| ID                                   | Name    | Status | Networks                         | Image Name |
+--------------------------------------+---------+--------+----------------------------------+------------+
| 132e5c32-b18c-40e7-bab0-af313ce35b41 | test-vm | ACTIVE | ljw-net=10.0.0.16, 192.168.18.13 | cirros     |
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm      | ACTIVE | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+---------+--------+----------------------------------+------------+

使用ip地址搜索实例
# openstack server list --ip 10.0.0.17                   不可以使用浮动ip
+--------------------------------------+------+--------+----------------------------------+------------+
| ID                                   | Name | Status | Networks                         | Image Name |
+--------------------------------------+------+--------+----------------------------------+------------+
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm   | ACTIVE | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+------+--------+----------------------------------+------------+

重启实例
# openstack server reboot vm
# openstack server list
+--------------------------------------+---------+--------+----------------------------------+------------+
| ID                                   | Name    | Status | Networks                         | Image Name |
+--------------------------------------+---------+--------+----------------------------------+------------+
| 132e5c32-b18c-40e7-bab0-af313ce35b41 | test-vm | ACTIVE | ljw-net=10.0.0.16, 192.168.18.13 | cirros     |
| 4d72b40f-b60b-4051-8de2-e237d14dee22 | vm      | REBOOT | ljw-net=10.0.0.17, 192.168.18.11 | cirros     |
+--------------------------------------+---------+--------+----------------------------------+------------+
重启实例默认是软重启
硬重启实例
# openstack server reboot --hard vm

通过控制台访问一个实例
# openstack console url show vm --xvpvnc
+-------+--------------------------------------------------------------------------+
| Field | Value                                                                    |
+-------+--------------------------------------------------------------------------+
| type  | xvpvnc                                                                   |
| url   | http://127.0.0.1:6081/console?token=cb7253b3-60e5-43ee-8930-8ba4cee3f34d |
+-------+--------------------------------------------------------------------------+















